{% extends "main/mobile_layout_bootstrap.html" %}
{% set active_page = 'reports' %}

{% block title %}Отчёты объекта - {{ object_obj.name }}{% endblock %}
{% block mobile_title %}{{ object_obj.name }}{% endblock %}

{% block mobile_header_actions %}
<div class="dropdown">
    <button class="btn btn-outline-light btn-sm" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="Навигация">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
        </svg>
    </button>
    <ul class="dropdown-menu dropdown-menu-end">
        <li><a class="dropdown-item" href="{{ url_for('main.reports') }}">
            <svg width="16" height="16" class="me-2" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5 8.186 1.113zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
            </svg>
            Все отчёты
        </a></li>
        <li><a class="dropdown-item" href="{{ url_for('main.reports_calendar') }}">
            <!-- Чистая иконка календаря -->
            <svg width="16" height="16" class="me-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="5" width="18" height="16" rx="3" ry="3"></rect>
                <line x1="16" y1="3" x2="16" y2="7"></line>
                <line x1="8" y1="3" x2="8" y2="7"></line>
                <line x1="3" y1="9" x2="21" y2="9"></line>
                <circle cx="8" cy="13.5" r="1.2"></circle>
                <circle cx="12" cy="13.5" r="1.2"></circle>
                <circle cx="16" cy="13.5" r="1.2"></circle>
                <circle cx="8" cy="17.5" r="1.2"></circle>
                <circle cx="12" cy="17.5" r="1.2"></circle>
                <circle cx="16" cy="17.5" r="1.2"></circle>
            </svg>
            Календарь отчётов
        </a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="{{ url_for('objects.object_detail', object_id=object_obj.id) }}">
            <svg width="16" height="16" class="me-2" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5 8.186 1.113zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
            </svg>
            Информация об объекте
        </a></li>
    </ul>
</div>
{% endblock %}

{% block content %}
<style>
.mobile-header-section {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

[data-bs-theme="dark"] .mobile-header-section {
    background: linear-gradient(135deg, #2d3748, #4a5568);
    border: 1px solid #4a5568;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

[data-bs-theme="dark"] .mobile-header-section h2 {
    color: #f7fafc;
}

.report-card-link {
    display: block;
    text-decoration: none;
    color: inherit;
    transition: background-color 0.2s;
    margin-bottom: 16px;
}

.report-card-link:hover {
    background-color: rgba(var(--bs-primary-rgb), 0.1);
    text-decoration: none;
    color: inherit;
}

.report-card-link:active {
    background-color: rgba(var(--bs-primary-rgb), 0.2);
}
</style>

<div class="mobile-header-section">
    <div class="d-flex align-items-center">
        <svg width="20" height="20" class="me-3" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5 8.186 1.113zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
        </svg>
        <h2 class="mb-0" style="font-size: 1.5rem; font-weight: 600;">Отчёты объекта</h2>
    </div>
</div>

{% if reports_by_date %}
    {% for date_key, reports in reports_by_date.items() %}
    <a href="{{ url_for('main.object_report_by_date', object_id=object_obj.id, date=date_key) }}" class="mobile-card report-card-link">
        <div class="mobile-card-title">
            <!-- Минималистичная иконка календаря возле даты -->
            <svg width="18" height="18" class="me-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="5" width="18" height="16" rx="3" ry="3"></rect>
                <line x1="16" y1="3" x2="16" y2="7"></line>
                <line x1="8" y1="3" x2="8" y2="7"></line>
                <line x1="3" y1="9" x2="21" y2="9"></line>
            </svg>
            {{ date_key.split('-')[2] }}.{{ date_key.split('-')[1] }}.{{ date_key.split('-')[0] }}
        </div>
        
        {% for report in reports %}
        <div class="mobile-card-text mobile-mb-2">
            <div class="d-flex justify-content-between align-items-start">
                <div style="flex: 1;">
                    <strong>{{ report.title or 'Отчёт' }}</strong>
                </div>
                <div class="text-end">
                    {% if report.status == 'approved' %}
                    <span class="badge bg-success">Одобрен</span>
                    {% elif report.status == 'pending' %}
                    <span class="badge bg-warning">На рассмотрении</span>
                    {% elif report.status == 'rejected' %}
                    <span class="badge bg-danger">Отклонён</span>
                    {% else %}
                    <span class="badge bg-secondary">{{ report.status or 'Не указан' }}</span>
                    {% endif %}
                </div>
            </div>
            
            {% if report.creator %}
            <div class="mobile-mt-1">
                <small class="text-muted">
                    <svg width="12" height="12" class="me-1" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                    </svg>
                    {{ report.creator.login }}
                </small>
            </div>
            {% endif %}
            
            {% if report.content %}
            <div class="mobile-mt-1">
                <small class="text-muted">{{ report.content[:100] }}{% if report.content|length > 100 %}...{% endif %}</small>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </a>
    {% endfor %}
{% else %}
    <div class="mobile-card">
        <div class="mobile-card-title">Нет отчётов</div>
        <div class="mobile-card-text text-center text-muted">
            <svg width="48" height="48" class="mb-2" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5 8.186 1.113zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
            </svg>
            <p>Для этого объекта пока нет отчётов</p>
        </div>
    </div>
{% endif %}


<!-- Дополнительный отступ для нижней панели -->
<div style="height: 80px"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Улучшаем скролл (тема уже инициализирована в layout)
    const content = document.querySelector('.mobile-content');
    if (content) {
        content.style.webkitOverflowScrolling = 'touch';
        content.style.scrollBehavior = 'smooth';
        const currentPaddingBottom = parseInt(window.getComputedStyle(content).paddingBottom || '0', 10);
        if (currentPaddingBottom < 140) {
            content.style.paddingBottom = '140px';
        }
    }
});
</script>
{% endblock %}
