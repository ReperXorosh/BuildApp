{% extends "main/mobile_layout_bootstrap.html" %}
{% set active_page = 'objects' %}

{% block title %}Объект: {{ object.name }}{% endblock %}
{% block mobile_title %}{{ object.name }}{% endblock %}

{% block content %}
<div class="mobile-card">
    <div class="mobile-card-title">Информация</div>
    <div class="mobile-card-text"><strong>Название:</strong> {{ object.name }}</div>
    {% if object.location %}
    <div class="mobile-card-text"><strong>Адрес:</strong> {{ object.location }}</div>
    {% endif %}
    {% if object.description %}
    <div class="mobile-card-text"><strong>Описание:</strong> {{ object.description }}</div>
    {% endif %}
</div>

<div class="mobile-card">
    <div class="mobile-card-title">Действия</div>
    <div class="row g-2">
        <div class="col-6 d-flex flex-column gap-2">
            <a href="{{ url_for('objects.supports_list', object_id=object.id) }}" class="btn btn-outline-primary w-100 mobile-action-btn">Опоры</a>
            <a href="{{ url_for('objects.trenches_list', object_id=object.id) }}" class="btn btn-outline-primary w-100 mobile-action-btn">Траншеи</a>
        </div>
        <div class="col-6 d-flex flex-column gap-2">
            <a href="{{ url_for('objects.reports_list', object_id=object.id) }}" class="btn btn-outline-primary w-100 mobile-action-btn">Отчёты</a>
            <a href="{{ url_for('objects.checklist_view', object_id=object.id) }}?mobile=1" class="btn btn-outline-primary w-100 mobile-action-btn">Чек‑лист</a>
        </div>
        <div class="col-12">
            <div class="accordion" id="mobileObjectElements">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="mobHeadZdf">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mobColZdf" aria-expanded="false" aria-controls="mobColZdf">ЗДФ</button>
                    </h2>
                    <div id="mobColZdf" class="accordion-collapse collapse" aria-labelledby="mobHeadZdf" data-bs-parent="#mobileObjectElements">
                        <div class="accordion-body">
                            {% if object.zdfs and object.zdfs|length %}
                            <ul class="list-group list-group-flush">
                                {% for z in object.zdfs %}
                                <li class="list-group-item">{{ z.zdf_number }}{% if z.zdf_name %} — {{ z.zdf_name }}{% endif %}</li>
                                {% endfor %}
                            </ul>
                            {% else %}<div class="text-muted">Нет ЗДФ</div>{% endif %}
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="mobHeadBr">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mobColBr" aria-expanded="false" aria-controls="mobColBr">Кронштейны</button>
                    </h2>
                    <div id="mobColBr" class="accordion-collapse collapse" aria-labelledby="mobHeadBr" data-bs-parent="#mobileObjectElements">
                        <div class="accordion-body">
                            {% if object.brackets and object.brackets|length %}
                            <ul class="list-group list-group-flush">
                                {% for b in object.brackets %}
                                <li class="list-group-item">{{ b.bracket_number }}{% if b.bracket_name %} — {{ b.bracket_name }}{% endif %}</li>
                                {% endfor %}
                            </ul>
                            {% else %}<div class="text-muted">Нет кронштейнов</div>{% endif %}
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="mobHeadLum">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mobColLum" aria-expanded="false" aria-controls="mobColLum">Светильники</button>
                    </h2>
                    <div id="mobColLum" class="accordion-collapse collapse" aria-labelledby="mobHeadLum" data-bs-parent="#mobileObjectElements">
                        <div class="accordion-body">
                            {% if object.luminaires and object.luminaires|length %}
                            <ul class="list-group list-group-flush">
                                {% for l in object.luminaires %}
                                <li class="list-group-item">{{ l.luminaire_number }}{% if l.luminaire_name %} — {{ l.luminaire_name }}{% endif %}</li>
                                {% endfor %}
                            </ul>
                            {% else %}<div class="text-muted">Нет светильников</div>{% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 pt-1">
            <a href="{{ url_for('objects.planned_works_overview', _external=False) }}" class="btn btn-outline-primary w-100 mobile-action-btn">Работы</a>
        </div>
    </div>
    {# Кнопка назад скрыта для мобильной версии. Навигация назад осуществляется стрелкой в шапке. #}
</div>

<!-- Дополнительный отступ, чтобы контент не перекрывался нижней панелью навигации -->
<div style="height: 140px"></div>

<script>
// Плавный скролл (тема уже инициализирована в layout)
document.addEventListener('DOMContentLoaded', function() {
    // Добавочный safeguard для скроллинга
        const content = document.querySelector('.mobile-content');
        if (content) {
            content.style.webkitOverflowScrolling = 'touch';
            content.style.scrollBehavior = 'smooth';
            // На всякий случай усилим нижний внутренний отступ
            const currentPaddingBottom = parseInt(window.getComputedStyle(content).paddingBottom || '0', 10);
            if (currentPaddingBottom < 140) {
                content.style.paddingBottom = '140px';
            }
        }
    } catch (e) { /* noop */ }
});
</script>
<style>
/* Аккуратные контрастные outline-кнопки для обеих тем */
.mobile-action-btn {
    min-height: 44px;
    font-weight: 600;
    border-radius: 12px;
    padding: 10px 14px;
}
.btn-outline-primary.mobile-action-btn {
    color: var(--bs-primary) !important;
    border-width: 2px !important;
}
.btn-outline-primary.mobile-action-btn:hover {
    color: #fff !important;
    background-color: var(--bs-primary) !important;
    border-color: var(--bs-primary) !important;
}
[data-bs-theme="dark"] .btn-outline-primary.mobile-action-btn {
    color: #64a3ff !important;
    border-color: #2b69d7 !important;
}
[data-bs-theme="dark"] .btn-outline-primary.mobile-action-btn:hover {
    background-color: #2b69d7 !important;
    border-color: #2b69d7 !important;
    color: #fff !important;
}
</style>
{% endblock %}


