{% extends "main/mobile_layout.html" %}

{% block title %}Объекты{% endblock %}
{% block mobile_title %}Объекты{% endblock %}

{% block content %}
<div class="mobile-mb-3">
    <h2 class="mobile-card-title mobile-text-center">Список объектов</h2>
    <p class="mobile-text-muted mobile-text-center">Выберите объект для просмотра деталей</p>
</div>

{% if objects %}
    {% for obj in objects %}
    <div class="mobile-card" onclick="window.location.href='{{ url_for('objects.object_detail', object_id=obj.id) }}'">
        <div class="mobile-card-title">{{ obj.name }}</div>
        <div class="mobile-card-text mobile-mb-2">
            <strong>Адрес:</strong> {{ obj.address or 'Не указан' }}
        </div>
        <div class="mobile-card-text mobile-mb-2">
            <strong>Статус:</strong> 
            <span class="badge bg-{{ 'success' if obj.status == 'Активный' else 'secondary' }}">
                {{ obj.status or 'Не указан' }}
            </span>
        </div>
        <div class="mobile-card-text mobile-mb-2">
            <strong>Отчётов:</strong> {{ obj.reports|length + obj.daily_reports|length }}
        </div>
        {% if obj.description %}
        <div class="mobile-card-text">
            <strong>Описание:</strong> {{ obj.description[:100] }}{% if obj.description|length > 100 %}...{% endif %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    <div class="mobile-card mobile-text-center">
        <div class="mobile-card-title">Объекты не найдены</div>
        <div class="mobile-card-text">В системе пока нет объектов</div>
    </div>
{% endif %}

<!-- Кнопка добавления объекта (только для админов) -->
{% if current_user.role in ['Инженер ПТО', 'Зам. директор', 'Ген. директор'] %}
<div class="mobile-mt-3">
    <button class="mobile-btn mobile-btn-primary" onclick="window.location.href='{{ url_for('objects.add_object') }}'">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
        </svg>
        Добавить объект
    </button>
</div>
{% endif %}

<!-- Статистика -->
{% if objects %}
<div class="mobile-mt-3">
    <div class="mobile-card">
        <div class="mobile-card-title">Статистика</div>
        <div class="mobile-card-text">
            <strong>Всего объектов:</strong> {{ objects|length }}<br>
            <strong>Активных:</strong> {{ objects|selectattr('status', 'equalto', 'Активный')|list|length }}<br>
            <strong>Всего отчётов:</strong> {{ objects|sum(attribute='reports')|length + objects|sum(attribute='daily_reports')|length }}
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
