{% extends "main/layout.html" %}
{% block title %}Элемент: {{ element_type }}{% endblock %}
{% block content %}
<div class="container py-4">
  <h2 class="mb-3">{{ element_type }}</h2>
  <div class="card">
    <div class="card-body">
      <dl class="row mb-0">
        <dt class="col-sm-3">Название</dt>
        <dd class="col-sm-9">{{ element.zdf_name or element.bracket_name or element.luminaire_name or '—' }}</dd>
        <dt class="col-sm-3">Статус</dt>
        <dd class="col-sm-9">
          {% if element.status %}
          {% set status_translation = {
              'pending': 'Ожидает',
              'in_progress': 'В работе',
              'completed': 'Завершено',
              'cancelled': 'Отменено',
              'active': 'Активно',
              'inactive': 'Неактивно',
              'installed': 'Установлено',
              'not_installed': 'Не установлено',
              'working': 'Работает',
              'broken': 'Сломано',
              'maintenance': 'Обслуживание',
              'planned': 'Запланировано'
          } %}
          {{ status_translation.get(element.status.lower(), element.status) }}
          {% else %}
          —
          {% endif %}
        </dd>
        <dt class="col-sm-3">Заметки</dt>
        {% set _notes_lines = (element.notes or '').split('\n') %}
        {% set _filtered = [] %}
        {% for _l in _notes_lines %}
          {% set _t = _l|trim %}
          {% if _t and ('Файл:' not in _t) %}{% set _ = _filtered.append(_t) %}{% endif %}
        {% endfor %}
        <dd class="col-sm-9">{{ (_filtered|length > 0) and (_filtered|join('\n')|replace('\n','<br>')|safe) or '—' }}</dd>
        <!-- DEBUG: attachments count = {{ attachments|length }} -->
        {% if attachments %}
          <dt class="col-sm-3">Файлы</dt>
          <dd class="col-sm-9">
            {% for attachment in attachments %}
            <div class="mb-2">
              <a href="{{ url_for('objects.view_element_attachment', object_id=object.id, element_type=element_type.lower(), element_id=element.id, attachment_id=attachment.id) }}" 
                 target="_blank" class="btn btn-sm btn-outline-secondary me-2" title="Просмотреть файл">
                <i class="bi bi-file-earmark-text me-1"></i>
                {{ attachment.original_filename }}
              </a>
              <small class="text-muted">({{ attachment.size_bytes // 1024 }} КБ)</small>
            </div>
            {% endfor %}
          </dd>
        {% else %}
          <!-- DEBUG: No attachments found -->
        {% endif %}
      </dl>
    </div>
  </div>
  <a href="{{ url_for('objects.elements_list', object_id=object.id) }}" class="btn btn-secondary mt-3">Назад к элементам</a>
</div>
{% endblock %}
