{% extends "main/mobile_layout_bootstrap.html" %}
{% set active_page = 'objects' %}

{% block title %}{{ element_type }}{% endblock %}
{% block mobile_title %}{{ element_type }}{% endblock %}

{% block content %}
<div class="mobile-card">
    <div class="mobile-card-title">{{ element_type }}</div>
    <div class="mobile-card-text">
        <div class="mb-2"><strong>Объект:</strong> {{ object.name }}</div>
        {% if object.location %}
        <div class="mb-2"><strong>Адрес:</strong> {{ object.location }}</div>
        {% endif %}
    </div>
</div>

<div class="mobile-card">
    <div class="d-flex justify-content-between align-items-center">
        <div class="mobile-card-title m-0">Информация</div>
        <a class="btn btn-sm btn-outline-secondary" target="_blank"
           href="{{ url_for('objects.view_element_attachment_latest', object_id=object.id, element_type=element_type_code, element_id=element.id) }}"
           title="Просмотреть файл">
            <i class="bi bi-eye"></i>
        </a>
    </div>
    <div>
        <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">Название</span>
            <span class="fw-semibold">{{ element.zdf_name or element.bracket_name or element.luminaire_name or '—' }}</span>
        </div>
        <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">Статус</span>
            <span class="badge bg-secondary">
              {% if element.status %}
              {% set status_translation = {
                  'pending': 'Ожидает',
                  'in_progress': 'В работе',
                  'completed': 'Завершено',
                  'cancelled': 'Отменено',
                  'active': 'Активно',
                  'inactive': 'Неактивно',
                  'installed': 'Установлено',
                  'not_installed': 'Не установлено',
                  'working': 'Работает',
                  'broken': 'Сломано',
                  'maintenance': 'Обслуживание',
                  'planned': 'Запланировано'
              } %}
              {{ status_translation.get(element.status.lower(), element.status) }}
              {% else %}
              —
              {% endif %}
            </span>
        </div>
    {% set _notes_lines = (element.notes or '').split('\n') %}
    {% set _filtered = [] %}
    {% set file_url = None %}
    {% for _l in _notes_lines %}
      {% if 'Файл:' in _l %}
        {% set file_url = _l|replace('Файл:', '')|trim %}
      {% else %}
        {% set _ = _filtered.append(_l) %}
      {% endif %}
    {% endfor %}
    <div class="mt-2">
        <div class="text-muted mb-1">Примечания</div>
        {% set _trimmed = [] %}
        {% for _l in _filtered %}
          {% set _t = _l|trim %}
          {% if _t %}{% set _ = _trimmed.append(_t) %}{% endif %}
        {% endfor %}
        <div>{{ (_trimmed|length > 0) and (_trimmed|join('\n')|replace('\n','<br>')|safe) or '—' }}</div>
    </div>
    {% if attachments %}
    <div class="mt-3">
        <div class="text-muted mb-2">Файлы:</div>
        
        {% for attachment in attachments %}
        <div class="mb-2">
            <a href="{{ url_for('objects.view_element_attachment', object_id=object.id, element_type=element_type.lower(), element_id=element.id, attachment_id=attachment.id) }}" 
               target="_blank" class="btn btn-sm btn-outline-secondary w-100">
                <i class="bi bi-file-earmark-text me-1"></i>
                {{ attachment.original_filename }}
            </a>
            <small class="text-muted">({{ attachment.size_bytes // 1024 }} КБ)</small>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    </div>
    <div class="mt-3 d-flex" style="gap:8px;">
        <a href="{{ url_for('objects.elements_list', object_id=object.id) }}" class="btn btn-outline-secondary w-100">К элементам</a>
        <a href="{{ url_for('objects.object_detail', object_id=object.id) }}" class="btn btn-primary w-100">К объекту</a>
    </div>
    <div class="mt-2 small text-muted">ID: {{ element.id }}</div>
    
</div>

<!-- Отступ под нижнюю навигацию -->
<div style="height: 120px"></div>
{% endblock %}


